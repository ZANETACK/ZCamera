!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ZCamera=t()}(this,(function(){"use strict";function e(e){this._init(e),this._camera()}return function(e){e.prototype._init=function(e){var t=this;t.$options={isOpen:!1,isLoading:!1,mediaOptions:{audio:!0,video:{width:640,height:360}}},Object.assign(t.$options,e),t.$el=document.querySelector(e.el),t.oldMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMeddia||navigator.msGetUserMedia,t.newMedia=navigator.mediaDevices}}(e),function(e){e.prototype._html=function(){this.$el.innerHTML='<video id="camera-video"></video>',this.$cameraVideo=document.querySelector("#camera-video")}}(e),function(e){e.prototype._camera=function(){},e.prototype._newOpenCamera=function(){var e=this;e.newMedia.getUserMedia(e.$options.mediaOptions).then((function(t){console.info("Camera\u63d0\u9192\uff1a\u4f60\u6b63\u5728\u4f7f\u7528\u65b0\u7248\u672c\u6d4f\u89c8\u5668\u8c03\u7528\u6444\u50cf\u5934"),e._handleStream(t)})).catch((function(t){e.openReject&&e.openReject({status:"openError",error:t})}))},e.prototype._oldOpenCamera=function(){var e=this;try{e.oldMedia(e.$options.mediaOptions,(function(t){console.info("Camera\u63d0\u9192\uff1a\u4f60\u6b63\u5728\u4f7f\u7528\u8001\u7248\u672c\u6d4f\u89c8\u5668\u8c03\u7528\u6444\u50cf\u5934,\u4e3a\u4e86\u4fdd\u8bc1\u8d28\u91cf\u8bf7\u5207\u6362\u5230\u8c37\u6b4c\u65b0\u7248\u672c\u6d4f\u89c8\u5668"),e._handleStream(t)}),(function(t){e.openReject&&e.openReject({status:"openError",error:t})}))}catch(e){console.warn("Camera\u63d0\u9192\uff1a\u4f60\u7684\u6d4f\u89c8\u5668\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7\u5207\u6362\u5230\u8c37\u6b4c\u65b0\u7248\u672c\u6d4f\u89c8\u5668")}},e.prototype._onloadedmetadata=function(){var e=this;e.$cameraVideo.play(),e._setOpen(!0),e._setLoading(!1)},e.prototype._handleStream=function(e){var t=this;t.$cameraVideo&&("srcObject"in t.$cameraVideo?t.$cameraVideo.srcObject=e:t.$cameraVideo.src=(window.URL||window.webkitURL).createObjectURL(e),t.$cameraVideo.onloadedmetadata=t._onloadedmetadata.apply(t)),t.mediaStreamTrack="function"==typeof e.stop?e:e.getTracks()[0],t.openResolve&&t.openResolve({status:"opened"})},e.prototype._setLoading=function(e){var t=this;t.$options.isLoading=e,!e&&this.$options.stop&&t.$options.stop(t)},e.prototype._setOpen=function(e){this.$options.isOpen=e},e.prototype.open=function(){var e=this;return new Promise((function(t,o){e.openResolve=t,e.openReject=o,e._html(),e._setLoading(!0),e.newMedia&&e.newMedia.getUserMedia?e._newOpenCamera():e.oldMedia&&e._oldOpenCamera()}))},e.prototype.stop=function(){var e=this;return new Promise((function(t){try{e.mediaStreamTrack&&e.mediaStreamTrack.stop(),e._setOpen(!1),e._setLoading(!1),e.$el.removeChild(e.$cameraVideo)}catch(e){}t({status:"stopOver"})}))},e.prototype.cut=function(){var e=this;return new Promise((function(t,o){if(e.$options.isOpen){var n=document.createElement("canvas"),i=e.$cameraVideo.videoWidth,a=e.$cameraVideo.videoHeight;n.width=i,n.height=a,n.getContext("2d").drawImage(e.$cameraVideo,0,0,i,a),t(n.toDataURL("image/png"))}else o({status:"cutError"})}))},e.prototype.getMedia=function(){return this.mediaStreamTrack}}(e),e}));
