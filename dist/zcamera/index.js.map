{"version":3,"file":"index.js","sources":["../../src/initMixin.js","../../src/initHTML.js","../../src/initCamera.js","../../src/main.js"],"sourcesContent":["export default function (Camera) {\r\n    Camera.prototype._init = function (options) {\r\n        const vm = this;\r\n        //初始化配置\r\n        vm.$options = {\r\n            isOpen: false,\r\n            isLoading: false,\r\n            //相机的配置\r\n            mediaOptions: {\r\n                audio: true,\r\n                video: {\r\n                    width: 640,\r\n                    height: 360\r\n                }\r\n            }\r\n        }\r\n        Object.assign(vm.$options, options);\r\n        \r\n        //创建元素\r\n        vm.$el = document.querySelector(options.el);\r\n       \r\n        //创建相机API\r\n        //获取媒体方法（旧方法）\r\n        vm.oldMedia =  navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMeddia || navigator.msGetUserMedia;\r\n        //获取媒体方法（新方法）\r\n        vm.newMedia = navigator.mediaDevices;\r\n    }\r\n}\r\n","export default function (Camera) {\r\n    Camera.prototype._html = function () {\r\n        const vm = this;\r\n        vm.$el.innerHTML = `<video id=\"camera-video\"></video>`;\r\n        vm.$cameraVideo = document.querySelector('#camera-video');\r\n    }\r\n}\r\n","export default function (Camera) {\r\n    Camera.prototype._camera = function () {\r\n        const vm = this;\r\n    }\r\n    Camera.prototype._newOpenCamera = function () {\r\n        const vm = this;\r\n        vm.newMedia.getUserMedia(vm.$options.mediaOptions).then(stream => {\r\n            vm.console && console.info('Camera提醒：你正在使用新版本浏览器调用摄像头')\r\n            vm._handleStream(stream)\r\n        }).catch(function (error) {\r\n            if(vm.openReject)vm.openReject({status: 'openError', error})\r\n        });\r\n    }\r\n    \r\n    Camera.prototype._oldOpenCamera = function () {\r\n        const vm = this;\r\n        try {\r\n            vm.oldMedia(vm.$options.mediaOptions, function (stream) {\r\n                vm.console && console.info('Camera提醒：你正在使用老版本浏览器调用摄像头,为了保证质量请切换到谷歌新版本浏览器')\r\n                vm._handleStream(stream)\r\n            }, function (error) {\r\n                if(vm.openReject)vm.openReject({status: 'openError', error})\r\n            });\r\n        } catch (e) {\r\n            vm.console && console.warn('Camera提醒：你的浏览器版本过低，请切换到谷歌新版本浏览器')\r\n        }\r\n    }\r\n    \r\n    Camera.prototype._onloadedmetadata = function () {\r\n        const vm = this;\r\n        vm.$cameraVideo.play();\r\n        vm._setOpen(true);\r\n        vm._setLoading(false);\r\n    }\r\n    \r\n    Camera.prototype._handleStream = function (stream) {\r\n        const vm = this;\r\n        if (vm.$cameraVideo) {\r\n            if ('srcObject' in vm.$cameraVideo) {\r\n                vm.$cameraVideo.srcObject = stream;\r\n            } else {\r\n                //新版本已经废弃\r\n                vm.$cameraVideo.src = (window.URL || window.webkitURL).createObjectURL(stream);\r\n            }\r\n            vm.$cameraVideo.onloadedmetadata = vm._onloadedmetadata.apply(vm);\r\n        }\r\n        vm.mediaStreamTrack = typeof stream.stop === 'function' ? stream : stream.getTracks()[0];\r\n        if (vm.openResolve) {\r\n            vm.openResolve({status: 'opened'})\r\n        }\r\n    }\r\n    \r\n    Camera.prototype._setLoading = function (bool) {\r\n        const vm = this;\r\n        vm.$options.isLoading = bool;\r\n        if (!bool && this.$options.stop) {\r\n            vm.$options.stop(vm)\r\n        }\r\n    }\r\n    \r\n    Camera.prototype._setOpen = function (bool) {\r\n        this.$options.isOpen = bool;\r\n    }\r\n    \r\n    /**************外部api**************/\r\n    Camera.prototype.open = function () {\r\n        const vm = this;\r\n        return new Promise((resolve, reject) => {\r\n            vm.openResolve = resolve;\r\n            vm.openReject = reject;\r\n            vm._html();\r\n            vm._setLoading(true);\r\n            if (vm.newMedia && vm.newMedia.getUserMedia) {\r\n                vm._newOpenCamera()\r\n            } else if (vm.oldMedia) {\r\n                vm._oldOpenCamera()\r\n            }\r\n        })\r\n    }\r\n    \r\n    Camera.prototype.stop = function () {\r\n        const vm = this;\r\n        return new Promise(resolve => {\r\n           try{\r\n               vm.mediaStreamTrack && vm.mediaStreamTrack.stop();\r\n               vm._setOpen(false);\r\n               vm._setLoading(false);\r\n               vm.$el.removeChild(vm.$cameraVideo);\r\n           }catch (e) {}\r\n            resolve({status: 'stopOver'})\r\n        })\r\n    }\r\n    \r\n    Camera.prototype.cut = function () {\r\n        const vm = this;\r\n        return new Promise((resolve, reject) => {\r\n            if(!vm.$options.isOpen){\r\n                reject({status: 'cutError'})\r\n            }else{\r\n                const canvas = document.createElement('canvas');\r\n                const width = vm.$cameraVideo.videoWidth;\r\n                const height = vm.$cameraVideo.videoHeight;\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                const ctx = canvas.getContext('2d');\r\n                ctx.drawImage(vm.$cameraVideo, 0, 0, width, height);\r\n                const base64 = canvas.toDataURL('image/png');\r\n                resolve(base64)\r\n            }\r\n        })\r\n    }\r\n    \r\n    Camera.prototype.getMedia = function () {\r\n        return this.mediaStreamTrack\r\n    }\r\n    \r\n}\r\n","import initMixin from \"./initMixin\";\r\nimport initHTML from \"./initHTML\"\r\nimport initCamera from \"./initCamera\"\r\nfunction Camera(options) {\r\n    this._init(options);\r\n    this._camera()\r\n}\r\n\r\ninitMixin(Camera);\r\ninitHTML(Camera);\r\ninitCamera(Camera);\r\nexport default Camera;\r\n"],"names":["Camera","prototype","_init","options","vm","$options","isOpen","isLoading","mediaOptions","audio","video","width","height","Object","assign","$el","document","querySelector","el","oldMedia","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMeddia","msGetUserMedia","newMedia","mediaDevices","_html","innerHTML","$cameraVideo","_camera","_newOpenCamera","then","stream","console","info","_handleStream","error","openReject","status","_oldOpenCamera","e","warn","_onloadedmetadata","play","_setOpen","_setLoading","srcObject","src","window","URL","webkitURL","createObjectURL","onloadedmetadata","apply","mediaStreamTrack","stop","getTracks","openResolve","bool","open","Promise","resolve","reject","removeChild","cut","canvas","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","base64","toDataURL","getMedia","initMixin","initHTML","initCamera"],"mappings":"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"}