{"version":3,"file":"index.js","sources":["../../src/initMixin.js","../../src/initHTML.js","../../src/initCamera.js","../../src/main.js"],"sourcesContent":["export default function (Camera) {\r\n    Camera.prototype._init = function (options) {\r\n        const vm = this;\r\n        //初始化配置\r\n        vm.$options = {\r\n            isOpen: false,\r\n            isLoading: false,\r\n            mediaOptions: {//相机的配置\r\n                width: 1280,\r\n                height: 720,\r\n                video: true,\r\n            }\r\n        }\r\n        Object.assign(vm.$options, options);\r\n        \r\n        //创建元素\r\n        vm.$el = document.querySelector(options.el);\r\n       \r\n        //创建相机API\r\n        //获取媒体方法（旧方法）\r\n        vm.oldMedia =  navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMeddia || navigator.msGetUserMedia;\r\n        //获取媒体方法（新方法）\r\n        vm.newMedia = navigator.mediaDevices;\r\n    }\r\n}\r\n","export default function (Camera) {\r\n    Camera.prototype._html = function () {\r\n        const vm = this;\r\n        vm.$el.innerHTML = `<video id=\"camera-video\"></video>`;\r\n        vm.$cameraVideo = document.querySelector('#camera-video');\r\n    }\r\n}\r\n","export default function (Camera) {\r\n    Camera.prototype._camera = function () {\r\n        const vm = this;\r\n    }\r\n    Camera.prototype._newOpenCamera = function () {\r\n        const vm = this;\r\n        vm.newMedia.getUserMedia(vm.$options.mediaOptions).then(stream => {\r\n            vm.console && console.info('Camera提醒：你正在使用新版本浏览器调用摄像头')\r\n            vm._handleStream(stream)\r\n        }).catch(function(err) {\r\n            console.warn(err)\r\n        });\r\n    }\r\n    \r\n    Camera.prototype._oldOpenCamera = function(){\r\n        const vm = this;\r\n        try {\r\n            vm.oldMedia(vm.$options.mediaOptions, function(stream) {\r\n                vm.console && console.info('Camera提醒：你正在使用老版本浏览器调用摄像头,为了保证质量请切换到谷歌新版本浏览器')\r\n                vm._handleStream(stream)\r\n            }, function(err) {\r\n                console.warn(err)\r\n            });\r\n        }catch (e) {\r\n            vm.console && console.warn('Camera提醒：你的浏览器版本过低，请切换到谷歌新版本浏览器')\r\n        }\r\n    }\r\n    \r\n    Camera.prototype._onloadedmetadata = function(){\r\n        const vm = this;\r\n        vm.$cameraVideo.play();\r\n        vm._setOpen(true);\r\n        vm._setLoading(false);\r\n    }\r\n    \r\n    Camera.prototype._handleStream = function(stream){\r\n        const vm = this;\r\n        if(vm.$cameraVideo){\r\n            if('srcObject' in vm.$cameraVideo){\r\n                vm.$cameraVideo.srcObject = stream;\r\n            }else{\r\n                //新版本已经废弃\r\n                vm.$cameraVideo.src = (window.URL || window.webkitURL).createObjectURL(stream);\r\n            }\r\n            vm.$cameraVideo.onloadedmetadata = vm._onloadedmetadata.apply(vm);\r\n        }\r\n        vm.mediaStreamTrack = typeof stream.stop === 'function' ? stream : stream.getTracks()[0];\r\n        if(vm.$options.init){\r\n            vm.$options.init({status: 'opened'})\r\n        }\r\n    }\r\n    \r\n    Camera.prototype.getMedia = function () {\r\n        return this.mediaStreamTrack\r\n    }\r\n    \r\n    Camera.prototype.open = function () {\r\n        const vm = this;\r\n        vm._html();\r\n        vm._setLoading(true);\r\n        if(vm.$options.init){\r\n            vm.$options.init({status: 'opening'})\r\n        }\r\n        if(vm.newMedia  && vm.newMedia.getUserMedia){\r\n            vm._newOpenCamera()\r\n        }else if(vm.oldMedia){\r\n            vm._oldOpenCamera()\r\n        }\r\n        return vm;\r\n    }\r\n    \r\n    Camera.prototype.stop = function(){\r\n        const vm = this;\r\n        vm.mediaStreamTrack && vm.mediaStreamTrack.stop();\r\n        vm._setOpen(false);\r\n        vm._setLoading(false);\r\n        vm.$el.removeChild(vm.$cameraVideo);\r\n    }\r\n    \r\n    Camera.prototype._setLoading = function (bool) {\r\n        const vm = this;\r\n        vm.$options.isLoading = bool;\r\n        if(!bool && this.$options.stop){\r\n            vm.$options.stop(vm)\r\n        }\r\n    }\r\n    Camera.prototype._setOpen = function (bool) {\r\n        this.$options.isOpen = bool;\r\n    }\r\n    \r\n}\r\n","import initMixin from \"./initMixin\";\r\nimport initHTML from \"./initHTML\"\r\nimport initCamera from \"./initCamera\"\r\nfunction Camera(options) {\r\n    this._init(options);\r\n    this._camera()\r\n}\r\n\r\ninitMixin(Camera);\r\ninitHTML(Camera);\r\ninitCamera(Camera);\r\nexport default Camera;\r\n"],"names":["Camera","prototype","_init","options","vm","$options","isOpen","isLoading","mediaOptions","width","height","video","Object","assign","$el","document","querySelector","el","oldMedia","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMeddia","msGetUserMedia","newMedia","mediaDevices","_html","innerHTML","$cameraVideo","_camera","_newOpenCamera","then","stream","console","info","_handleStream","err","warn","_oldOpenCamera","e","_onloadedmetadata","play","_setOpen","_setLoading","srcObject","src","window","URL","webkitURL","createObjectURL","onloadedmetadata","apply","mediaStreamTrack","stop","getTracks","init","status","getMedia","open","removeChild","bool","initMixin","initHTML","initCamera"],"mappings":";;;;;;IAAe,oBAAUA,MAAV,EAAkB;IAC7BA,EAAAA,MAAM,CAACC,SAAP,CAAiBC,KAAjB,GAAyB,UAAUC,OAAV,EAAmB;IACxC,QAAMC,EAAE,GAAG,IAAX,CADwC;;IAGxCA,IAAAA,EAAE,CAACC,QAAH,GAAc;IACVC,MAAAA,MAAM,EAAE,KADE;IAEVC,MAAAA,SAAS,EAAE,KAFD;IAGVC,MAAAA,YAAY,EAAE;IAAC;IACXC,QAAAA,KAAK,EAAE,IADG;IAEVC,QAAAA,MAAM,EAAE,GAFE;IAGVC,QAAAA,KAAK,EAAE;IAHG;IAHJ,KAAd;IASAC,IAAAA,MAAM,CAACC,MAAP,CAAcT,EAAE,CAACC,QAAjB,EAA2BF,OAA3B,EAZwC;;IAexCC,IAAAA,EAAE,CAACU,GAAH,GAASC,QAAQ,CAACC,aAAT,CAAuBb,OAAO,CAACc,EAA/B,CAAT,CAfwC;IAkBxC;;IACAb,IAAAA,EAAE,CAACc,QAAH,GAAeC,SAAS,CAACC,YAAV,IAA0BD,SAAS,CAACE,kBAApC,IAA0DF,SAAS,CAACG,gBAApE,IAAwFH,SAAS,CAACI,cAAjH,CAnBwC;;IAqBxCnB,IAAAA,EAAE,CAACoB,QAAH,GAAcL,SAAS,CAACM,YAAxB;IACH,GAtBD;IAuBH;;ICxBc,mBAAUzB,MAAV,EAAkB;IAC7BA,EAAAA,MAAM,CAACC,SAAP,CAAiByB,KAAjB,GAAyB,YAAY;IACjC,QAAMtB,EAAE,GAAG,IAAX;IACAA,IAAAA,EAAE,CAACU,GAAH,CAAOa,SAAP;IACAvB,IAAAA,EAAE,CAACwB,YAAH,GAAkBb,QAAQ,CAACC,aAAT,CAAuB,eAAvB,CAAlB;IACH,GAJD;IAKH;;ICNc,qBAAUhB,MAAV,EAAkB;IAC7BA,EAAAA,MAAM,CAACC,SAAP,CAAiB4B,OAAjB,GAA2B,YAAY;IAEtC,GAFD;;IAGA7B,EAAAA,MAAM,CAACC,SAAP,CAAiB6B,cAAjB,GAAkC,YAAY;IAC1C,QAAM1B,EAAE,GAAG,IAAX;IACAA,IAAAA,EAAE,CAACoB,QAAH,CAAYJ,YAAZ,CAAyBhB,EAAE,CAACC,QAAH,CAAYG,YAArC,EAAmDuB,IAAnD,CAAwD,UAAAC,MAAM,EAAI;IAC9D5B,MAAAA,EAAE,CAAC6B,OAAH,IAAcA,OAAO,CAACC,IAAR,CAAa,2BAAb,CAAd;;IACA9B,MAAAA,EAAE,CAAC+B,aAAH,CAAiBH,MAAjB;IACH,KAHD,WAGS,UAASI,GAAT,EAAc;IACnBH,MAAAA,OAAO,CAACI,IAAR,CAAaD,GAAb;IACH,KALD;IAMH,GARD;;IAUApC,EAAAA,MAAM,CAACC,SAAP,CAAiBqC,cAAjB,GAAkC,YAAU;IACxC,QAAMlC,EAAE,GAAG,IAAX;;IACA,QAAI;IACAA,MAAAA,EAAE,CAACc,QAAH,CAAYd,EAAE,CAACC,QAAH,CAAYG,YAAxB,EAAsC,UAASwB,MAAT,EAAiB;IACnD5B,QAAAA,EAAE,CAAC6B,OAAH,IAAcA,OAAO,CAACC,IAAR,CAAa,8CAAb,CAAd;;IACA9B,QAAAA,EAAE,CAAC+B,aAAH,CAAiBH,MAAjB;IACH,OAHD,EAGG,UAASI,GAAT,EAAc;IACbH,QAAAA,OAAO,CAACI,IAAR,CAAaD,GAAb;IACH,OALD;IAMH,KAPD,CAOC,OAAOG,CAAP,EAAU;IACPnC,MAAAA,EAAE,CAAC6B,OAAH,IAAcA,OAAO,CAACI,IAAR,CAAa,iCAAb,CAAd;IACH;IACJ,GAZD;;IAcArC,EAAAA,MAAM,CAACC,SAAP,CAAiBuC,iBAAjB,GAAqC,YAAU;IAC3C,QAAMpC,EAAE,GAAG,IAAX;IACAA,IAAAA,EAAE,CAACwB,YAAH,CAAgBa,IAAhB;;IACArC,IAAAA,EAAE,CAACsC,QAAH,CAAY,IAAZ;;IACAtC,IAAAA,EAAE,CAACuC,WAAH,CAAe,KAAf;IACH,GALD;;IAOA3C,EAAAA,MAAM,CAACC,SAAP,CAAiBkC,aAAjB,GAAiC,UAASH,MAAT,EAAgB;IAC7C,QAAM5B,EAAE,GAAG,IAAX;;IACA,QAAGA,EAAE,CAACwB,YAAN,EAAmB;IACf,UAAG,eAAexB,EAAE,CAACwB,YAArB,EAAkC;IAC9BxB,QAAAA,EAAE,CAACwB,YAAH,CAAgBgB,SAAhB,GAA4BZ,MAA5B;IACH,OAFD,MAEK;IACD;IACA5B,QAAAA,EAAE,CAACwB,YAAH,CAAgBiB,GAAhB,GAAsB,CAACC,MAAM,CAACC,GAAP,IAAcD,MAAM,CAACE,SAAtB,EAAiCC,eAAjC,CAAiDjB,MAAjD,CAAtB;IACH;;IACD5B,MAAAA,EAAE,CAACwB,YAAH,CAAgBsB,gBAAhB,GAAmC9C,EAAE,CAACoC,iBAAH,CAAqBW,KAArB,CAA2B/C,EAA3B,CAAnC;IACH;;IACDA,IAAAA,EAAE,CAACgD,gBAAH,GAAsB,OAAOpB,MAAM,CAACqB,IAAd,KAAuB,UAAvB,GAAoCrB,MAApC,GAA6CA,MAAM,CAACsB,SAAP,GAAmB,CAAnB,CAAnE;;IACA,QAAGlD,EAAE,CAACC,QAAH,CAAYkD,IAAf,EAAoB;IAChBnD,MAAAA,EAAE,CAACC,QAAH,CAAYkD,IAAZ,CAAiB;IAACC,QAAAA,MAAM,EAAE;IAAT,OAAjB;IACH;IACJ,GAfD;;IAiBAxD,EAAAA,MAAM,CAACC,SAAP,CAAiBwD,QAAjB,GAA4B,YAAY;IACpC,WAAO,KAAKL,gBAAZ;IACH,GAFD;;IAIApD,EAAAA,MAAM,CAACC,SAAP,CAAiByD,IAAjB,GAAwB,YAAY;IAChC,QAAMtD,EAAE,GAAG,IAAX;;IACAA,IAAAA,EAAE,CAACsB,KAAH;;IACAtB,IAAAA,EAAE,CAACuC,WAAH,CAAe,IAAf;;IACA,QAAGvC,EAAE,CAACC,QAAH,CAAYkD,IAAf,EAAoB;IAChBnD,MAAAA,EAAE,CAACC,QAAH,CAAYkD,IAAZ,CAAiB;IAACC,QAAAA,MAAM,EAAE;IAAT,OAAjB;IACH;;IACD,QAAGpD,EAAE,CAACoB,QAAH,IAAgBpB,EAAE,CAACoB,QAAH,CAAYJ,YAA/B,EAA4C;IACxChB,MAAAA,EAAE,CAAC0B,cAAH;IACH,KAFD,MAEM,IAAG1B,EAAE,CAACc,QAAN,EAAe;IACjBd,MAAAA,EAAE,CAACkC,cAAH;IACH;;IACD,WAAOlC,EAAP;IACH,GAbD;;IAeAJ,EAAAA,MAAM,CAACC,SAAP,CAAiBoD,IAAjB,GAAwB,YAAU;IAC9B,QAAMjD,EAAE,GAAG,IAAX;IACAA,IAAAA,EAAE,CAACgD,gBAAH,IAAuBhD,EAAE,CAACgD,gBAAH,CAAoBC,IAApB,EAAvB;;IACAjD,IAAAA,EAAE,CAACsC,QAAH,CAAY,KAAZ;;IACAtC,IAAAA,EAAE,CAACuC,WAAH,CAAe,KAAf;;IACAvC,IAAAA,EAAE,CAACU,GAAH,CAAO6C,WAAP,CAAmBvD,EAAE,CAACwB,YAAtB;IACH,GAND;;IAQA5B,EAAAA,MAAM,CAACC,SAAP,CAAiB0C,WAAjB,GAA+B,UAAUiB,IAAV,EAAgB;IAC3C,QAAMxD,EAAE,GAAG,IAAX;IACAA,IAAAA,EAAE,CAACC,QAAH,CAAYE,SAAZ,GAAwBqD,IAAxB;;IACA,QAAG,CAACA,IAAD,IAAS,KAAKvD,QAAL,CAAcgD,IAA1B,EAA+B;IAC3BjD,MAAAA,EAAE,CAACC,QAAH,CAAYgD,IAAZ,CAAiBjD,EAAjB;IACH;IACJ,GAND;;IAOAJ,EAAAA,MAAM,CAACC,SAAP,CAAiByC,QAAjB,GAA4B,UAAUkB,IAAV,EAAgB;IACxC,SAAKvD,QAAL,CAAcC,MAAd,GAAuBsD,IAAvB;IACH,GAFD;IAIH;;ICvFD,SAAS5D,MAAT,CAAgBG,OAAhB,EAAyB;IACrB,OAAKD,KAAL,CAAWC,OAAX;;IACA,OAAK0B,OAAL;IACH;;IAEDgC,SAAS,CAAC7D,MAAD,CAAT;IACA8D,QAAQ,CAAC9D,MAAD,CAAR;IACA+D,UAAU,CAAC/D,MAAD,CAAV;;;;;;;;"}